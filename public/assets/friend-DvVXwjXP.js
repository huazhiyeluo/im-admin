import{f as b,g as C,o as M,S as O,y as l,z as o,j as d,G as B,H as S,p as m,l as x,c as A,A as f,B as u,I as N}from"./index-CvA2DDGm.js";import{a as j}from"./index-Dti_npMt.js";import{s as c}from"./chat-BrYYxUVl.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";const L={class:"contact-list"},V=["onClick"],z={class:"user-details"},D={class:"user-name"},w=b({__name:"friend",props:["db"],emits:["update-parameter"],setup(p,{expose:_,emit:U}){const a=p,g=U,e=C({selftUserInfo:{},friends:[],loading:!1,finished:!1});M(()=>{v()});const v=()=>{e.selftUserInfo=O.get("userInfo"),I()},I=async()=>{j({fromId:e.selftUserInfo.Uid}).then(async n=>{if(n.data){e.friends=n.data;for(const s of e.friends)c(a.db,s)}})},h=n=>{if(n.ToId==e.selftUserInfo.Uid)for(const s in e.friends)e.friends[s].Uid==n.FromId&&(n.MsgMedia==11?e.friends[s].IsOnline=!0:n.MsgMedia==12&&(e.friends[s].IsOnline=!1),c(a.db,e.friends[s]))},y=n=>{const s=JSON.parse(n.Content.Data);if(s.user)if(n.MsgMedia==24)e.friends=e.friends.filter(i=>i.Uid!==s.user.Uid);else{if(e.friends.some(t=>t.Uid===s.user.Uid)){for(const t in e.friends)if(e.friends[t].Uid==s.user.Uid){e.friends[t]=s.user;break}}else e.friends.unshift(s.user);c(a.db,s.user)}},k=async n=>{g("update-parameter",1,n)};return _({loadUserStatus:h,loadUserManage:y}),(n,s)=>{const i=l("van-image"),t=l("van-empty");return o(),d("div",L,[e.friends.length>0?(o(!0),d(B,{key:0},S(e.friends,r=>(o(),d("div",{class:"contact-item",onClick:E=>k(r.Uid)},[A(i,{width:"50",height:"50",round:"",src:r.Avatar},null,8,["src"]),f("div",z,[f("div",D,u(r.Username)+"["+u(r.Uid)+"]",1),f("div",{class:N(r.IsOnline?"status online":"status offline")},null,2)])],8,V))),256)):m("",!0),e.friends.length==0?(o(),x(t,{key:1,description:"暂无好友"})):m("",!0)])}}}),$=F(w,[["__scopeId","data-v-b737fd79"]]);export{$ as default};
