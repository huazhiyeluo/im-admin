import{f as y,g as U,o as k,S as C,y as c,z as p,j as u,G as N,H as j,p as i,l as A,c as B,A as d,B as g}from"./index-CvA2DDGm.js";import{b as O}from"./index-Dti_npMt.js";import{a as f,d as x,b as M,s as S,c as L}from"./chat-BrYYxUVl.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";const D={class:"contact-list"},w=["onClick"],z={class:"user-details"},E={class:"user-name"},F=y({__name:"group",props:["db"],emits:["update-parameter"],setup(l,{expose:m,emit:I}){const t=l,_=I,s=U({selftUserInfo:{},groups:[],loading:!1,finished:!1});k(()=>{G()});const G=()=>{s.selftUserInfo=C.get("userInfo"),b()},b=async()=>{O({fromId:s.selftUserInfo.Uid}).then(r=>{if(r.data){s.groups=r.data;for(const o of s.groups)f(t.db,o)}})},v=r=>{const o=JSON.parse(r.Content.Data);if(o.group)if(r.MsgMedia==34){if(s.selftUserInfo.Uid==o.user.Uid)x(t.db,o.group.GroupId),s.groups=s.groups.filter(a=>a.GroupId!==o.group.GroupId);else if(s.groups.some(e=>e.GroupId===o.group.GroupId)){for(const e in s.groups)if(s.groups[e].GroupId==o.group.GroupId){s.groups[e]=o.group;break}}M(t.db,o.group.GroupId,o.user.Uid)}else{if(s.groups.some(e=>e.GroupId===o.group.GroupId)){for(const e in s.groups)if(s.groups[e].GroupId==o.group.GroupId){s.groups[e]=o.group;break}}else s.groups.unshift(o.group);f(t.db,o.group),o.user&&(S(t.db,o.user),L(t.db,o.group.GroupId,o.user))}},h=async r=>{_("update-parameter",2,r)};return m({loadUserManage:v}),(r,o)=>{const a=c("van-image"),e=c("van-empty");return p(),u("div",D,[s.groups.length>0?(p(!0),u(N,{key:0},j(s.groups,n=>(p(),u("div",{class:"contact-item",onClick:H=>h(n.GroupId)},[B(a,{width:"50",height:"50",round:"",src:n.Icon},null,8,["src"]),d("div",z,[d("div",E,g(n.Name)+"["+g(n.Num)+"]",1)])],8,w))),256)):i("",!0),s.groups.length==0?(p(),A(e,{key:1,description:"暂无群组"})):i("",!0)])}}}),P=V(F,[["__scopeId","data-v-db346e58"]]);export{P as default};
